{% extends "base.html" %}

{% block title %}Explainability - Vehicle Registration Predictor{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: center;">
            <div>
                <h1><i class="fas fa-lightbulb"></i> SHAP Explainability</h1>
                <p>Understand how our AI model makes predictions and why each factor matters</p>
            </div>
            <div style="text-align: center; display: flex; justify-content: center; align-items: center;">
                <img src="/static/images/sharp_explain.jpg" alt="Vehicle Registration Analysis" style="max-width: 100%; height: auto; border-radius: 12px; filter: drop-shadow(0 8px 24px rgba(0, 102, 204, 0.15)); width: 100%; max-height: 400px; object-fit: cover;">
            </div>
        </div>
    </div>
    <!-- What is SHAP Section -->
    <section class="about-section">
        <h2><i class="fas fa-book"></i> What is SHAP?</h2>
        <p>SHAP (SHapley Additive exPlanations) is an advanced technique that explains machine learning model predictions by calculating each feature's contribution to the final forecast. It uses game theory to determine fair feature importance, showing which factors matter most for predictions.</p>
    </section>

    <!-- Model Explainability -->
    <section class="about-section">
        <h2><i class="fas fa-chart-column"></i> Overall Feature Importance</h2>
        <p>Here's how each feature contributes to vehicle registration predictions:</p>
        
        <div class="feature-importance-cards">
            <div class="importance-card">
                <div class="importance-rank">1</div>
                <div class="importance-info">
                    <h4>Previous Month Registrations</h4>
                    <p class="importance-value">Very High Impact</p>
                    <p class="importance-explain">The strongest predictor - based on momentum from previous month</p>
                </div>
                <div class="importance-bar" style="width: 100%"></div>
            </div>

            <div class="importance-card">
                <div class="importance-rank">2</div>
                <div class="importance-info">
                    <h4>Monthly Growth Rate</h4>
                    <p class="importance-value">High Impact</p>
                    <p class="importance-explain">Expected trend direction and strength significantly influence forecast</p>
                </div>
                <div class="importance-bar" style="width: 85%"></div>
            </div>

            <div class="importance-card">
                <div class="importance-rank">3</div>
                <div class="importance-info">
                    <h4>Market Share</h4>
                    <p class="importance-value">High Impact</p>
                    <p class="importance-explain">Category's market position affects registration volume</p>
                </div>
                <div class="importance-bar" style="width: 78%"></div>
            </div>

            <div class="importance-card">
                <div class="importance-rank">4</div>
                <div class="importance-info">
                    <h4>Yearly Stock</h4>
                    <p class="importance-value">Moderate Impact</p>
                    <p class="importance-explain">Available inventory levels constrain registration potential</p>
                </div>
                <div class="importance-bar" style="width: 62%"></div>
            </div>

            <div class="importance-card">
                <div class="importance-rank">5</div>
                <div class="importance-info">
                    <h4>Is Peak Season</h4>
                    <p class="importance-value">Moderate Impact</p>
                    <p class="importance-explain">Seasonal buying patterns significantly shift registration numbers</p>
                </div>
                <div class="importance-bar" style="width: 55%"></div>
            </div>

            <div class="importance-card">
                <div class="importance-rank">6</div>
                <div class="importance-info">
                    <h4>Transfer Ratio</h4>
                    <p class="importance-value">Low-Moderate Impact</p>
                    <p class="importance-explain">Vehicle transfers contribute secondary influence on registrations</p>
                </div>
                <div class="importance-bar" style="width: 35%"></div>
            </div>
        </div>
    </section>

    <!-- How Predictions Work -->
    <section class="about-section">
        <h2><i class="fas fa-cogs"></i> How Prediction Explainability Works</h2>
        
        <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 2rem; border-radius: 12px; margin: 2rem 0;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;"><i class="fas fa-input"></i></div>
                    <h4>1. User Input</h4>
                    <p style="font-size: 0.9rem;">You provide market parameters for a future period</p>
                </div>

                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;"><i class="fas fa-microchip"></i></div>
                    <h4>2. Model Prediction</h4>
                    <p style="font-size: 0.9rem;">CatBoost calculates registration forecast</p>
                </div>

                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;"><i class="fas fa-tree"></i></div>
                    <h4>3. SHAP Analysis</h4>
                    <p style="font-size: 0.9rem;">Analyzes how each feature contributed</p>
                </div>

                <div style="text-align: center;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;"><i class="fas fa-chart-bar"></i></div>
                    <h4>4. Feature Importance</h4>
                    <p style="font-size: 0.9rem;">Shows top factors that influenced forecast</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Example Explanation -->
    <section class="about-section">
        <h2><i class="fas fa-example"></i> Example: Bus Forecast January 2026</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1.5rem;">
            <div class="example-card">
                <h4><i class="fas fa-info-circle"></i> Input Parameters</h4>
                <ul style="list-style: none; padding: 0;">
                    <li><strong>Category:</strong> Bus</li>
                    <li><strong>Year:</strong> 2026</li>
                    <li><strong>Month:</strong> January</li>
                    <li><strong>Previous Month Reg:</strong> 118 vehicles</li>
                    <li><strong>Expected Growth:</strong> +2%</li>
                    <li><strong>Peak Season:</strong> No</li>
                    <li><strong>Crisis Period:</strong> No</li>
                </ul>
            </div>

            <div class="example-card">
                <h4><i class="fas fa-chart-line"></i> Prediction Result</h4>
                <div style="text-align: center; padding: 1rem; background: #f0f4ff; border-radius: 8px; margin-bottom: 1rem;">
                    <p style="font-size: 0.9rem; color: #666; margin: 0;">Predicted Registration</p>
                    <p style="font-size: 2.5rem; font-weight: bold; color: #0066cc; margin: 0.5rem 0;">150 vehicles</p>
                    <p style="font-size: 0.85rem; color: #999; margin: 0;">±160 vehicle confidence range</p>
                </div>
                <h4><i class="fas fa-star"></i> Top Contributing Factors:</h4>
                <ul style="list-style: none; padding: 0; font-size: 0.9rem;">
                    <li>✓ Previous momentum (118 vehicles) - pushed prediction higher</li>
                    <li>✓ Modest growth rate (+2%) - added ~6 vehicles</li>
                    <li>✓ Normal season (not peak) - kept forecast realistic</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- When to Trust Predictions -->
    <section class="about-section">
        <h2><i class="fas fa-shield"></i> When to Trust Predictions</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div style="background: #d4edda; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #28a745;">
                <h4 style="color: #155724;"><i class="fas fa-check-circle"></i> High Confidence</h4>
                <ul style="color: #155724; margin: 0.5rem 0;">
                    <li>Predictions similar to historical patterns</li>
                    <li>All input parameters within normal ranges</li>
                    <li>No extreme market conditions specified</li>
                    <li>Model R² = 0.9842 (98.4% accurate)</li>
                </ul>
            </div>

            <div style="background: #fff3cd; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #ffc107;">
                <h4 style="color: #856404;"><i class="fas fa-exclamation-triangle"></i> Use with Caution</h4>
                <ul style="color: #856404; margin: 0.5rem 0;">
                    <li>Extreme growth rates (>50% or <-50%)</li>
                    <li>Crisis period with unusual parameter combinations</li>
                    <li>Very new vehicle categories with limited history</li>
                    <li>Parameters outside historical ranges</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="about-section" style="text-align: center; background: linear-gradient(135deg, #0369a1 0%, #0891b2 100%); color: white;">
        <h2 style="color: white;"><i class="fas fa-magic"></i> Ready to Make Predictions?</h2>
        <p style="color: rgba(255,255,255,0.9);">Now that you understand SHAP explainability, try making a forecast and see your prediction's explanation</p>
        <a href="/predict" class="btn btn-primary btn-large" style="background: white; color: #0369a1; margin-top: 1rem;">
            <i class="fas fa-magic"></i> Get Started with Predictions
        </a>
    </section>
</div>

<style>
.feature-importance-cards {
    display: grid;
    gap: 1rem;
    margin-top: 1.5rem;
}

.importance-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #0369a1;
    display: grid;
    grid-template-columns: 40px 1fr 60px;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.importance-rank {
    width: 40px;
    height: 40px;
    background: #0369a1;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
}

.importance-info h4 {
    margin: 0 0 0.3rem 0;
    font-size: 1rem;
    color: #333;
}

.importance-value {
    margin: 0 0 0.2rem 0;
    font-size: 0.85rem;
    font-weight: 600;
    color: #0369a1;
}

.importance-explain {
    margin: 0;
    font-size: 0.8rem;
    color: #666;
}

.importance-bar {
    height: 6px;
    background: linear-gradient(90deg, #0369a1 0%, #0891b2 100%);
    border-radius: 3px;
}
</style>
{% endblock %}
